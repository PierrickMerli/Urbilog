<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <title>Tabs accessible</title>
        <link rel="stylesheet" href="styles.css">
    </head>
    <body>
        <div role="tablist" aria-label="Exemple d'onglets">
            <button role="tab" id="tab1" aria-controls="panel1" aria-selected="true" tabindex="0">Ressources Web</button>
            <button role="tab" id="tab2" aria-controls="panel2" aria-selected="false" tabindex="-1">Outils de développement</button>
            <button role="tab" id="tab3" aria-controls="panel3" aria-selected="false" tabindex="-1">Références</button>
        </div>

        <div id="panel1" role="tabpanel" aria-labelledby="tab1" class="active" tabindex="0">
            <h2>Ressources Web</h2>
            <a href="#">Guide d'accessibilité WCAG</a>
            <a href="#">Documentation ARIA</a>
            <a href="#">Bonnes pratiques HTML</a>
            <p>Cette version est accessible via la navigation au clavier. Essayez d'utiliser Tab et les flèches gauche/droite.</p>
        </div>
        <div id="panel2" role="tabpanel" aria-labelledby="tab2" tabindex="0">
            <h2>Outils de développement</h2>
            <a href="#">Chrome DevTools</a>
            <a href="#">Firefox Developer Tools</a>
            <a href="#">VS Code Extensions</a>
            <p>La navigation au clavier fonctionne correctement ici grâce aux attributs ARIA.</p>
        </div>
        <div id="panel3" role="tabpanel" aria-labelledby="tab3" tabindex="0">
            <h2>Références</h2>
            <a href="#">MDN Web Docs</a>
            <a href="#">Stack Overflow</a>
            <a href="#">GitHub</a>
            <p>Les liens sont accessibles via la tabulation et les onglets sont contrôlables au clavier.</p>
        </div>

        <script>
            const tabs = document.querySelectorAll('[role="tab"]');
            const panels = document.querySelectorAll('[role="tabpanel"]');
            let currentTabIndex = 0;

            // Fonction pour trouver l'index de l'onglet actif
            function getCurrentTabIndex() {
                return Array.from(tabs).findIndex(tab => tab.getAttribute('aria-selected') === 'true');
            }

            // Fonction pour activer un onglet
            function activateTab(index) {
                currentTabIndex = index;
                tabs.forEach((t, i) => {
                    t.setAttribute("aria-selected", i === index);
                    t.setAttribute("tabindex", i === index ? "0" : "-1");
                });
                panels.forEach((p, i) => {
                    p.classList.toggle("active", i === index);
                    // Mettre à jour le tabindex du panel
                    p.setAttribute("tabindex", i === index ? "0" : "-1");
                });
            }

            // Gestionnaire pour les onglets
            tabs.forEach((tab, index) => {
                tab.addEventListener("click", () => {
                    activateTab(index);
                    tabs[index].focus();
                });
            });

            // Gestionnaire pour les panels
            panels.forEach((panel, index) => {
                panel.addEventListener("focus", () => {
                    activateTab(index);
                });
            });

            // Gestionnaire global pour les touches fléchées
            document.addEventListener("keydown", (e) => {
                const activeElement = document.activeElement;
                const isPanel = activeElement.getAttribute('role') === 'tabpanel';
                const isTab = activeElement.getAttribute('role') === 'tab';

                if (e.key === "ArrowRight" || e.key === "ArrowLeft") {
                    e.preventDefault();
                    const direction = e.key === "ArrowRight" ? 1 : -1;
                    const newIndex = (currentTabIndex + direction + tabs.length) % tabs.length;
                    activateTab(newIndex);
                    // Si on était sur un panel, on reste sur le panel
                    if (isPanel) {
                        panels[newIndex].focus();
                    } else {
                        tabs[newIndex].focus();
                    }
                }
            });

            // Initialisation
            activateTab(0);
        </script>
    </body>
</html>
